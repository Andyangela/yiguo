<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="../../js/rem.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/reset.css" />
    <link rel="stylesheet" type="text/css" href="../../css/classify/in.css" />
    <link rel="stylesheet" href="../../css/classify/loading.css">
</head>

<body>
    <div class="tabNav line-bottom">
        <div class="tabMain">
            <div class="active">
                销量
            </div>
            <div class="">
                新品
            </div>
            <div class="">
                价格
                <i class=""></i></div>
        </div>
    </div>
    <div class="outermost">
        <!-- <div class="productList line-bottom">
			<div class="shop_info">
                <div class="img">
                    <i class="not">抢光了</i>
                    <img src="../../images/grop/binggan/170427094654078_1247049_300.jpg" alt="">
                </div>
				<div class="info">
					<p class="title">美心礼盒装香脆甜心酥212g</p>
					<p class="txt">满口绵密酥香</p>
					<p class="price">
						<span class="pricrRed">¥138</span>
						<span class="standard">212g/盒</span>
						<span class="addCart"></span>
					</p>
				</div>
			</div>
		</div> -->
    </div>
    <!-- 购物车 -->
    <div class="option">
        <a class="num"><i id="shop_num">0</i></a>
        <a href="#" id="gotop" class="top"></a>
    </div>
    <!-- 没有更多了 -->
    <div class="noMore" style="display: none">
        <p>没有更多了</p>
    </div>
    <!-- 弹出层 -->
    <div class="on_loading">
        <div class="loading">
            <img src="../../images/grop/1.gif" alt="">
        </div>
    </div>
    <script src="../../js/jquery/jquery-1.12.1.js"></script>
    <script src="../../js/jquery.lazyload.min.js"></script>
    <script type="text/javascript" src="../../js/mui.min.js"></script>
    <script src="../../js/grop.js"></script>
    <script>
        $(function () {
            // 截取url id
            var item_id = window.location.search.split('=')[1]
            // loading加载数据
            $(".on_loading").show()
            $.ajax({
                url: "../../php/seafood.php",
                type: "POST",
                dataType: "json",
                data: 'item_id=' + item_id,
                success: function (data) {
                    var html = "";
                    for (var j = 0; j < data.length; j++) {
                        html += '<div class="productList line-bottom"><div class="shop_info"><div class="img"><a href="../details/particulars.html"><img data-original="' + data[j].img + '" alt="" class="lazy"></a></div><div class="info"><p class="title"> ' + data[j].title + '</p><p class="txt">' + data[j].txt + '</p><p class="price"><span class="pricrRed"> ' + data[j].priceRed + '</span><span class="standard">' + data[j].standard + '</span><span class="addCart"></span></p></div></div></div>';
                    }
                    $(".outermost").html(html);
                    // loading 消失
                    $(".on_loading").hide()
                    // 图片资源加载完毕
                    $("img.lazy").lazyload({ effect: "fadeIn" })
                    // 显示没有更多
                    $(".noMore").show()
                    $(".addCart").on("click", function () {
                        $("#shop_num").text() + 1
                        var num = $("#shop_num").text();
                        num++;
                        $("#shop_num").text(num);
                    })
                }
            })

            $(".tabMain div").on("click", function () {
                $(this).addClass("active").siblings().removeClass("active")
                // 判断当点击 新品时请求新品的内容
                $(".on_loading").show()
                $.ajax({
                    url: "../../php/seafood.php",
                    type: "POST",
                    dataType: "json",
                    data: 'item_id=' + item_id,
                    success: function (data) {
                        var html = "";
                        for (var j = 0; j < data.length; j++) {
                            html += '<div class="productList line-bottom"><div class="shop_info"><div class="img"><a href="../details/particulars.html"><img data-original="' + data[j].img + '" alt="" class="lazy"></a></div><div class="info"><p class="title"> ' + data[j].title + '</p><p class="txt">' + data[j].txt + '</p><p class="price"><span class="pricrRed"> ' + data[j].priceRed + '</span><span class="standard">' + data[j].standard + '</span><span class="addCart"></span></p></div></div></div>';
                        }
                        $(".outermost").html(html);
                        $("img.lazy").lazyload({ effect: "fadeIn" })
                        $(".on_loading").hide()
                        $(".noMore").show()
                        $(".addCart").on("click", function () {
                            $("#shop_num").text() + 1
                            var num = $("#shop_num").text();
                            num++;
                            $("#shop_num").text(num);
                        })
                    }
                })
            })
            // 价格
            var i = 1;
            $(".tabMain i").on("click", function () {
                if (i % 2 == 0) {
                    $(this).addClass("drop").siblings().removeClass("drop");
                } else {
                    $(this).addClass("litre").siblings().removeClass("litre")
                }
            })
            // 新品
        })
        $(".on_loading").show()
        $.ajax({
            url: "../../php/seafood.php",
            type: "POST",
            dataType: "json",
            success: function (data) {
                var html = "";
                for (var j = 0; j < data.length; j++) {
                    html += '<div class="productList line-bottom"><div class="shop_info"><div class="img"><a href="../details/particulars.html"><img data-original="' + data[j].img + '" alt="" class="lazy"></a></div><div class="info"><p class="title"> ' + data[j].title + '</p><p class="txt">' + data[j].txt + '</p><p class="price"><span class="pricrRed"> ' + data[j].priceRed + '</span><span class="standard">' + data[j].standard + '</span><span class="addCart"></span></p></div></div></div>';
                }
                $(".list_content").html(html);
                $("img.lazy").lazyload({ effect: "fadeIn" })
                $(".on_loading").hide()
                $(".noMore").show()
                //加入购物车
                // 添加购物车数量
                $(".addCart").on("click", function () {
					var title = $(this).parents(".info").children(".title").text(),
						goodsName = $(this).parents(".info").children(".txt").text(),
						// // 声明获取数据
						img_url = $(this).parents(".productList").find(".lazy").attr("src"),
						price = $(this).siblings(".pricrRed").text()
					// $.ajax({
					// 	url: '../../php/shop-car.php',
					// 	type: "POST",
					// 	data: 'title="' + title + '"&img_url=' + img_url + "&goodsName=" + goodsName + "&price=" + price + "&username=" + username,
					// 	success: function (data) {
					// 		console.log(data)
					// 	}
					// })
					$count = 1;
					$.ajax({
						url: '../../php/examnum.php',
						type: 'get',
						data: 'title="' + title + '"',
						success: function (data) {
							if (data == "添加一整条") {
								$.ajax({
									url: '../../php/index_addcart.php',
									type: 'post',
									data: {
										'img': img_url,
										'title': title,
										"money": price,
										'count': $count,
									},
								})
							} else {
								data = JSON.parse(data)
								$num = Number(data.count)
								$num++;
								$.ajax({
									url: '../../php/updatecount.php',
									type: 'get',
									data: 'count=' + $num + '&title="' + title + '"',
								})
							}
						}
					})
					$("#shop_num").text() + 1
					var num = $("#shop_num").text();
					num++;
					$("#shop_num").text(num);
				})
            }
        })

    </script>
</body>

</html>