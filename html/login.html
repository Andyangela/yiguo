<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>登录</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link href="../css/mui.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../css/reset.css" />
    <link rel="stylesheet" type="text/css" href="../css/login.css" />
  </head>

  <body>
    <form class="mui-input-group">
      <div class="mui-input-row">
        <label class="username"></label>
        <input
          type="text"
          class="mui-input"
          id="username"
          placeholder="请输入您的用户名"
        />
      </div>
      <div class="mui-input-row">
        <label class="password"></label>
        <input
          type="password"
          class="mui-input"
          id="password"
          placeholder="请输入您的密码"
        />
      </div>
      <div class="mui-input-row">
        <label></label>
        <input
          type="text"
          name="authcode"
          class="mui-input verify"
          id="verify"
          placeholder="请输入验证码"
        />
        <img
          id="captcha_img"
          border="1"
          src="../php/captcha.php?r=<?php echo rand();?>"
          onclick="document.getElementById('captcha_img').src='../php/captcha.php?r='+Math.random()"
        />
      </div>
    </form>
    <div class="forgetpassword"><a href="javascript:;">忘记密码？</a></div>
    <div class="mui-button-row btn">
      <button type="button" class="mui-btn mui-btn-primary">登录</button>
      <button type="button" class="mui-btn mui-btn-danger">立即注册</button>
    </div>
    <div class="bottomcopyright">
      <em class="yigo_logo"></em>
    </div>
    <!-- tip -->
    <div class="tip"></div>
    <script src="../js/mui.min.js"></script>
    <script src="../js/rem.js"></script>
    <script src="../js/jquery/jquery-1.12.1.js"></script>
    <script type="text/javascript">
      $(".mui-btn-danger").click(function() {
        location.href = "register.html";
      });
      function errortip(tipcontent) {
        $(".tip").html(tipcontent);
        $(".tip").css("display", "block");
        setTimeout(function() {
          $(".tip").css("display", "none");
        }, 2000);
      }
      $(".mui-btn-primary").click(function() {
        if ($("#username").val() == "") {
          errortip("请输入用户名");
        } else if (!$("#password").val()) {
          errortip("请输入密码");
        } else if (!$("#verify").val()) {
          errortip("请输入验证码");
        } else {
          $.ajax({
            url: "../php/verifyuser.php",
            type: "post",
            data:
              "username=" +
              $("#username").val() +
              "&password=" +
              $("#password").val(),
            success: function(data) {
              if (data == "登录失败") {
                errortip("用户名或密码错误");
              } else {
                $.ajax({
                  url: "../php/form.php",
                  type: "get",
                  data: "verify=" + $("#verify").val(),
                  success: function(data) {
                    if(data=="输入错误"){
                      errortip("验证码错误或已失效")
                    }else{
                      location.href="./index.html"
                      document.cookie="username="+$("#username").val();
                      Response.Cookies("username").expires=date()+7 
                    }
                  }
                });
              }
            }
          });
        }
      });
    </script>
  </body>
</html>
